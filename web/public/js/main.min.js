var BLOCK=!1,cropperRectangle=null;function block(){BLOCK=!0;$("#waitingbg").css({height:$(document).height()}).show()}function unblock(){$("#waitingbg").css({height:0}).hide();BLOCK=!1}(function(a){a.fn.hasScrollBar=function(){var a={},b=this.get(0);a.vertical=b.scrollHeight>b.clientHeight;a.horizontal=b.scrollWidth>b.clientWidth;return a}})(jQuery);$.widget("ui.dialog",$.ui.dialog,{_allowInteraction:function(a){return!!$(a.target).closest(".cke_dialog").length||this._super(a)}});
function getCookie(a){return(a=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)")))?decodeURIComponent(a[1]):void 0}function filter_input(a,c){a=a||window.event;var b=document.all;if("INPUT"==(a.target||a.srcElement).tagName.toUpperCase()){b=b?a.keyCode:a.which;if(32>b||a.ctrlKey||a.altKey)return!0;b=String.fromCharCode(b);if(!c.test(b))return!1}return!0}function changeNumberFrom1(a){a.value=a.value.replace(/^(0+)/,"")}
function check_form(a,c,b){var d=[],e=!1;switch(c){case "submit":$(".required",a).each(function(){var a=$(this);if("INPUT"==a.get(0).tagName||"SELECT"==a.get(0).tagName||"TEXTAREA"==a.get(0).tagName)if(""==$.trim(a.val())||"0"==$.trim(a.val())){var b=a.next().html();d.push(b?b:a.attr("title"));e||(a.focus(),e=!0)}});break;case "result":break;default:return!1}return 0<d.length?(a="",1<d.length&&(a=" \ufffd\ufffd "+d.pop()),$(".ui-dialog span.info").size()?($(".ui-dialog span.info").css({color:"#E82236"}).html(error_required_fields+
d.join(", ")+a+"."),$(".ui-dialog .results-block").slideDown("fast")):($("span.info").first().css({color:"#E82236"}).html(error_required_fields+d.join(", ")+a+"."),$(".results-block").first().slideDown("fast")),!1):!0}
var handlers={timeout:1E4,timeouts:{global_timeout:null},clearTimeout:function(a){clearTimeout(this.timeouts.global_timeout);null!=this.timeouts[a+"_info"]&&clearTimeout(this.timeouts[a+"_info"]);null!=this.timeouts[a+"_error"]&&clearTimeout(this.timeouts[a+"_error"])},SUCCESS_UPDATE_USER:function(a){$(".signup-form .info, .signup-form .error").empty();$(".signup-form .info").text(a);setTimeout(function(){$(".signup-form .info").empty()},this.timeout);$("#photo").val()&&$(".ur-right-part .bg-photo, .ur-right-part img").replaceWith('<div class="person-photo"><img id="person-photo" src="/user/getphoto?'+
1E6*Math.random()+1+'" height="128" width="114" alt="'+photo+'"/></div>');$("#photo").val("")},ERROR_UPDATE_USER:function(a){$(".signup-form .error, .signup-form .info").empty();$(".signup-form .error").text(a);setTimeout(function(){$(".signup-form .error").empty()},this.timeout)},SUCCESS_ADD:function(a){var c=$(a).find("input[id]").closest("tr").attr("class"),b=$("#"+c+"s-bl table tbody tr");if(b.size()){var d=b.size()-1;b.each(function(a){if(""==$(this).find("input[id]").val())return d=a,!1});if(0!=
d&&0==d||""!=b.eq(d).find("input[id]").val())b.eq(d).after(a),e=b.eq(d).next();else{b.eq(d).before(a);var e=b.eq(d).prev()}e.css("color","#444e8b");setTimeout(function(){e.css("color","")},4E3);e.find("a.description").tooltip();$("."+c+"s-empty").remove()}},SUCCESS_UPDATE:function(a){var c=$(a).find("input[id]").attr("id"),b=$("#"+c).closest("tr");b.size()&&(b.replaceWith(a),b=$("#"+c).closest("tr"),b.css("color","#444e8b"),setTimeout(function(){b.css("color","")},4E3),b.find("a.description").tooltip())},
SUCCESS_DELETE:function(a){var c=a.item.attr("href").replace(/\?(.*)$/g,"").split("/"),b=c[c.length-1].split("-")[0],c=c[c.length-1].split("-")[1],b=$("#"+b+c).closest("tr");0<b.length&&(b.remove(),this.clearTimeout(a.block),$("#"+a.block+"s-bl .info, #"+a.block+"s-bl .error").empty(),$("#"+a.block+"s-bl .info").text(successRemove[a.block]),this.timeouts[a.block+"_info"]=setTimeout(function(){$("#"+a.block+"s-bl .info").empty()},this.timeout));!$("#"+a.block+"s-bl table tbody tr").size()&&a.empty&&
$("#"+a.block+"s-bl table tbody").html(a.empty)},SUCCESS_DELETE_PHOTO:function(a){cropperRectangle.croppedImg.remove();cropperRectangle.croppedImg={};cropperRectangle.cropControlRemoveCroppedImage.hide();cropperRectangle.obj.addClass("bg-photo");typeof cropperRectangle.options.onAfterRemoveCroppedImg===typeof Function&&cropperRectangle.options.onAfterRemoveCroppedImg.call(that)},SUCCESS_UPDATE_SRVS_WNDS:function(a){$("#"+a.block+"s-bl table tbody").html(a.table);$("#"+a.block+"s-bl table tbody").find("a.description").each(function(){$(this).tooltip()});
this.clearTimeout(a.block);$("#"+a.block+"s-bl .error, #"+a.block+"s-bl .info").empty();$("#"+a.block+"s-bl .info").text(a.msg);this.timeouts[a.block+"_info"]=setTimeout(function(){$("#"+a.block+"s-bl .info").empty()},this.timeout)},SUCCESS_SIGNUP:function(a){this.clearTimeout("result");$(".error, .info").empty();$("#signup-form").dialog("close");$("#signup-form").css("display","none");$("#signup-form .left input, #signup-form .right input").val("");$("#results-bl .info").text(a);this.timeouts.result_info=
setTimeout(function(){$("#results-bl .info").empty()},this.timeout)},ERROR_SIGNUP:function(a){$(".error, .info").empty();$("#signup-form .results-block .error").text(a);$("#signup-form .results-block").show("slow")},SUCCESS_RECOVERY:function(a){this.clearTimeout("result");$(".error, .info").empty();$("#results-bl .info").text(a);this.timeouts.result_info=setTimeout(function(){$("#results-bl .info").empty()},this.timeout);$("#email-recovery").val("");$("#recovery-password").dialog("close")},ERROR_RECOVERY:function(a){$(".error, .info").empty();
$("#recovery-password .results-block .error").text(a);$("#recovery-password .results-block").show("slow")},LOCK_RECOVERY:function(a){this.clearTimeout("result");$(".error, .info").empty();$("#results-bl .error").text(a);this.timeouts.result_error=setTimeout(function(){$("#results-bl .error").empty()},this.timeout);$("#email-recovery").val("");$("#recovery-password").dialog("close")},FORM:function(a){modalPopup($("<div/>").html(a.form),{title:a.title,width:"undefined"!=typeof a.width?a.width:"inherit",
minHeight:"undefined"!=typeof a.minHeight?a.minHeight:"auto",position:$.extend({my:"center",at:"center",of:window},a.position),dialogClass:"undefined"!=typeof a.dialogClass?a.dialogClass:"content-c dialog-form-wrap"});on_submit()},SUCCESS_MAIL:function(a){this.clearTimeout("result");$(".error, .info").empty();this.timeouts.result_info=setTimeout(function(){$("#results-bl .info").empty()},this.timeout);$("#send-email input").val("");$("#"+$(".prompt-modal").attr("aria-describedby")).dialog("destroy");
$("#results-bl .info").text(a)},ERROR_MAIL:function(a){$(".error, .info").empty();$("#send-email .results-block .error").text(a);$("#send-email .results-block").show("slow")},ERROR:function(a){"undefined"==typeof a.block&&(a.block="result");this.clearTimeout(a.block);$("#"+a.block+"s-bl .error, #"+a.block+"s-bl .info").empty();$("#"+a.block+"s-bl .error").text(a.msg);this.timeouts[a.block+"_error"]=setTimeout(function(){$("#"+a.block+"s-bl .error").empty()},this.timeout)},USERS_FOUND:function(a){for(var c in a)$("<div>").append('<a href="/user/bcard/'+
a[c].value+'" target="_blank"><img src="'+(a[c].mini_photo?"/user/getminiphoto/"+a[c].value:"/public/images/mini_user.png")+'" height="32" width="32"/></a><table><tr><td><a href="/user/bcard/'+a[c].value+'" target="_blank">'+a[c].label+"</a></td></tr></table>").appendTo($("#search-result")).hide().fadeIn(1500)},USERS_NOT_FOUND:function(a){$("#search-result").is("p")||0!=a.start||$("<p>").text(a.label).appendTo($("#search-result").html(""))},SUCCESS_BCARD_CANCEL:function(a){$("#bcard-cancel").remove();
this.clearTimeout(a.block);$("#"+a.block+"s-bl .error, #"+a.block+"s-bl .info").empty();$("#"+a.block+"s-bl .info").text(a.msg);this.timeouts[a.block+"_info"]=setTimeout(function(){$("#"+a.block+"s-bl .info").empty()},this.timeout)},REDIRECT:function(a){location=cabinet}};function auth_submit(){$("#auth-form").submit(function(){var a=$(this).find("#password");a.val(hex_md5(hex_md5(a.val())+$("#challenge").val()));$("#challenge").remove()})}
function on_submit(){$("form").each(function(){var a=$(this);a.unbind().submit(function(){if(a.hasClass("no-ajax")||!a.hasClass("ajax"))return!0;if(BLOCK)return!1;var c=a.serialize(),b=a.attr("action");block();$("#recovery-password .results-block").hide("fast");$.ajax({url:b,type:"POST",data:c,cache:!1,success:function(a){unblock();$("#"+$(".dialog-form-wrap").attr("aria-describedby")).dialog("destroy");handlers[a.status](a.result)},error:function(a,b,c){unblock();alert("Ajax Error! Can't find path to file may be. "+
a.status+" "+c.message)}});return!1})});$("#user-update").unbind().submit(function(a){if(BLOCK)return!1;a=$(this)[0];var c=$("#pass"),b=$("#repeat-pass"),c=$.trim(c.val()),b=$.trim(b.val());if(""!=c&&"0"!=c){if(c!=b)return handlers.ERROR_UPDATE_USER(pass_not_eqauls),!1;if(c.length<pass_length)return handlers.ERROR_UPDATE_USER(error_pass_length),!1;a[7].value=hex_md5(c);a[8].value=hex_md5(b)}else if(""!=b&&"0"!=b)return handlers.ERROR_UPDATE_USER(pass_not_eqauls),!1;b=$(this).attr("action");a=new FormData(a);
$("#pass").val("");$("#repeat-pass").val("");block();$.ajax({url:b,type:"POST",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){unblock();handlers[a.status](a.result)},error:function(a,b,c){unblock();alert("Ajax Error! Can't find path to file may be. "+a.status+" "+c.message)}});return!1})}
function load_form(a){$("table, div.submit-row, .ur-right-part, h3").on("click","input.load-form, button.load-form",function(a){if(BLOCK)return!1;block();var b=$(this);a=$(this).attr("value");$.get(a,function(a){unblock();a.result.title=b.attr("title");handlers[a.status](a.result)});return!1})}function closeRemove(){$("#"+$(".dialog-form-wrap").attr("aria-describedby")+", #"+$(".prompt-modal").attr("aria-describedby")).dialog("destroy");return!0}
function dragDialogStop(a,c){$(this).parent().css({height:"auto"})}
function modalPopup(a,c,b,d,e){void 0===e&&(e=2500);"error"==b?a.html('<div class="popup-error"><p class="error">'+d+'</p><button type="button" class="button-ok" title="Ok">Ok</button></div>'):"info"==b&&(a.html('<div class="popup-info"><span class="info">'+d+'</span><button type="button" class="button-ok" role="button" title="Ok">Ok</button></div>'),b={effect:"fade",duration:1E3},c.show=b,c.hide=b,setTimeout(function(){a.dialog("close","widget").dialog("destroy")},e));a.dialog($.extend({autoOpen:!0,
modal:!0,close:closeRemove(),closeOnEscape:!0,resizable:!1,dragStop:dragDialogStop,dialogClass:"dialog-form-wrap content-c"},c),"widget");a.find(".close, .button-ok").click(function(){$("#"+$(".dialog-form-wrap").attr("aria-describedby")+", #"+$(".prompt-modal").attr("aria-describedby")).dialog("destroy")});a.find(".close").click(function(){$(".remove-dialog, #recovery-password, #signup-form").dialog("close");$(this).closest("form").find(".results-block").hide()})}
function remove_item(){$(".remove-dialog").size()&&(modalPopup($(".remove-dialog"),{autoOpen:!1,title:"",dialogClass:"delete-popup-wrap content-c"}),$("#services-bl table, #windows-bl table").on("click","input.remove",function(a){$(".remove-dialog .first-paragraph").empty();$(".remove-dialog .question").empty();$("#remove").attr("href","");var c="service";"window"==$(this).attr("value").substring(1).split("/")[2].split("-")[0]&&(c="window");var b=$(this).closest("tr").find("td.name").text();$(".delete-popup-wrap .ui-dialog-titlebar .ui-dialog-title").text(titleRemove[c]);
$(".remove-dialog .first-paragraph").text(textRemove+items[c]+' "'+b.trim()+'". '+removeNotice);$(".remove-dialog .question").text(questionRemove+items[c]+"?");$("#remove").attr("href",$(this).attr("value"));$(".remove-dialog").dialog("open");a.preventDefault()}));$("#remove").click(function(){var a=$(this);block();$.ajax({url:a.attr("href"),type:"POST",cache:!1,success:function(c){unblock();$("#"+$(".delete-popup-wrap").attr("aria-describedby")).dialog("close");c.result.item=a;handlers[c.status](c.result)},
error:function(a,b,d){unblock();alert("Ajax Error! Can't find path to file may be. "+a.status+" "+d.message)}});return!1})}function recovery_password(){$("#recovery-password").size()&&modalPopup($("#recovery-password"),{autoOpen:!1,title:recoveryPassword,dialogClass:"delete-popup-wrap content-c",width:"auto"});$("#a-recovery-password").click(function(a){$("#recovery-password").dialog("open");a.preventDefault()})}
function signup(){$("#signup-form").size()&&modalPopup($("#signup-form"),{autoOpen:!1,title:registration,dialogClass:"delete-popup-wrap content-c",width:"888px"});$("#signup-button").click(function(){$("#signup-form").size()?$("#signup-form").dialog("open"):handlers.ERROR({block:"result",msg:registrationLock})})}
$(document).ready(function(){$("#auth-form").size()&&$("#email").focus();$("#service-list, .col-1").on("mouseenter",".service-item",function(){$(this).addClass("outline")});$("#service-list, .col-1").on("mouseleave",".service-item",function(){$(this).removeClass("outline")});$("#bcard-cancel").click(function(){var a=$(this);block();$.ajax({url:a.attr("value"),type:"POST",cache:!1,success:function(a){unblock();handlers[a.status](a.result)},error:function(a,b,c){unblock();alert("Ajax Error! Can't find path to file may be. "+
a.status+" "+c.message)}});return!1});$("#services-bl table, #windows-bl table ").on("focus","input.order-window",function(){$(this).val();$(this)});$(".resize").resizable({minWidth:$(".content-c").width()-2,maxWidth:$(".content-c").width()-2,handles:"s, se",create:function(a,b){$(a.target).each(function(){$(this).find(".widget-wrap").hasScrollBar().vertical&&$(this).find(".ui-resizable-se").css("right","17px")})},stop:function(a,b){var c=b.element.closest(".window").find(".minimize,.expand").attr("id"),
d=b.size.height>=b.element.find(".widget-content").height()?0:b.size.height;$.ajax({type:"POST",url:"/settings/wndresize",data:"jsonData="+JSON.stringify({id_wnd:c,wnd_height:d}),dataType:"json",success:function(a){console.log(a)},error:function(a,b,c){alert("Ajax Error! Can't find path to file may be. "+a.status+" "+a.responseText+" "+c.message)}})},resize:function(a,b){b.element.find(".widget-wrap").css("height",b.size.height);b.element.css("height","auto");b.element.find(".widget-wrap").hasScrollBar().vertical?
b.element.find(".ui-resizable-se").css("right","17px"):(b.element.find(".ui-resizable-se").css("right","1px"),b.element.find(".widget-wrap").css("height","auto"))}});$(".minimize, .expand").click(function(a){var b=$(this).parent();b.next().is(":hidden")?(b.next().slideDown(300),$(this).removeClass("expand"),$(this).addClass("minimize"),b=$(this).closest(".window"),b.find(".widget-wrap").hasScrollBar().vertical&&b.find(".ui-resizable-se").css("right","17px")):(b.next().slideUp(300),$(this).removeClass("minimize"),
$(this).addClass("expand"));$.ajax({type:"POST",url:"/settings/wndclose",data:"jsonData="+JSON.stringify({id_wnd:$(this).attr("id"),wnd_close:$(this).hasClass("minimize")?1:0}),dataType:"json",success:function(a){console.log(a)},error:function(a,b,c){alert("Ajax Error! Can't find path to file may be. "+a.status+" "+a.responseText+""+c.message)}});a.preventDefault();return!1});$("a.description, input.description").tooltip();signup();recovery_password();remove_item();load_form();on_submit();auth_submit();
handlers.timeouts.global_timeout=setTimeout(function(){$("#results-bl .error, #results-bl .info").empty()},handlers.timeout);"/settings"==location.pathname&&(cropperRectangle=new Croppic("person-photo",{modal:!0,loaderHtml:'<div class="loader"><img width="47" height="47" src="/public/images/old/waiting.gif" alt="Waiting"></div>',rotateFactor:90,enableMousescroll:!0,imgEyecandyOpacity:.4,scaleToFill:!0,uploadUrl:"/user/uploadPhoto",cropUrl:"/user/cropPhoto",raiseObjSize:2,onError:function(a){handlers[a.status](a.result)},
onBeforeRemoveCroppedImg:function(){$(".remove-dialog .first-paragraph").empty();$(".remove-dialog .question").empty();$("#remove").attr("href","");$(".delete-popup-wrap .ui-dialog-titlebar .ui-dialog-title").text(titleRemove.photo);$(".remove-dialog .first-paragraph").text(photoTextRemove);$(".remove-dialog .question").text(photoQuestionRemove);$("#remove").attr("href","/user/removephoto");$(".remove-dialog").dialog("open")}}),$(".ur-right-part").on({mouseenter:function(){$(".cropControlsUpload").slideDown("fast")},
mouseleave:function(){$(".cropControlsUpload").slideUp("fast")}},"#person-photo"),$("#phone").mask("+38 (999) 999-99-99",{placeholder:"_"}));$("#birthday").mask("99.99.9999",{placeholder:datePlaceholer});if("/person/search"==location.pathname){var a=function(a){var e=a?a:window.event;a=a.keyCode||a.which;if("keypress"!=e.type||c(e)){if("keyup"==e.type&&13!=a&&40!=a&&8!=a&&46!=a)return!1;d=0;$("#search input").val().replace(/\*/g,"").length<=b?(f&&clearTimeout(f),$("#wrap-result-search ").html("")):
(f&&clearTimeout(f),f=setTimeout(function(){$("#search").submit()},500))}else if(13==a)return!1},c=function(a){return null==a.which?32>a.keyCode?null:String.fromCharCode(a.keyCode):0!=a.which&&0!=a.charCode?32>a.which?null:String.fromCharCode(a.which):null};$("#search input.text-search").focus();var b=2,d=0,e=16,l=0,h=0,k=$(".content-t").height()+$(".content-c").height(),g=!1;$("#search").submit(function(a){$("#search input.loop-search").attr("src","/public/images/ui-anim_basic_16x16.gif");a=$(this);
k<$(window).height()&&(e=4*Math.round(($(window).height()-k)/41+2),e=16<e?e:16);$.ajax({url:"/person/search",type:"POST",data:a.serialize()+"&"+$.param({data:{start:d,count:e}}),cache:!1,success:function(a){if("USERS_FOUND"==a.status){0==d&&(h=a.result.totalCount,$("#wrap-result-search ").html(""));a=a.result.users;for(var b in a)l++,$("<div>").append('<a href="/person/card/'+a[b].value+'" ><img src="'+(a[b].mini_photo?"/user/getminiphoto/"+a[b].value:"/public/images/mini_user.png")+'" height="32" width="32"/></a><table><tr><td><a href="/person/card/'+
a[b].value+'">'+a[b].label+"</a></td></tr></table>").appendTo($("#wrap-result-search ")).hide().slideToggle(500)}else"USERS_NOT_FOUND"==a.status&&0==d&&($("#wrap-result-search p").size()||$("<p>").text(a.result.label).appendTo($("#wrap-result-search ").html("")).hide().slideToggle(500))},error:function(a,b,c){alert("Ajax Error! Can't find path to file may be. "+a.status+" "+c.message)},complete:function(){$("#search input.loop-search").attr("src","/public/images/search.png");setTimeout(function(){g=
!1},200)}});return!1});var f=null;$("#search input").bind({input:a,keypress:a,keyup:a});$(window).scroll(function(a){$(window).height()+$(window).scrollTop()>=$(document).height()-75&&!g&&(g=!0,0!=d&&h-d<=e||$("#search input").val().length<=b?clearTimeout(f):(d+=e,$("#search").submit()))})}});
